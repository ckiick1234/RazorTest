@page
@model RazorTest.Pages.ManageProductModel
@{
    // Example: List<Product> Products = Model.Products;
    var showAddForm = TempData["ShowAddForm"] as bool? ?? false;
    var addProductError = TempData["AddProductError"] as string;
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />

<style>
    .table-forst {
        background-color: #228B22 !important;
        color: #fff !important;
    }
    .table-lime {
        background-color: #32CD32 !important;
        color: #fff !important;
    }
    .table-blue {
        background-color: #007bff !important;
        color: #fff !important;
    }
    .row-forst td {
        background-color: #228B22 !important;
        color: #fff !important;
    }
    .row-lime td {
        background-color: #32CD32 !important;
        color: #fff !important;
    }
    .row-blue td {
        background-color: #007bff !important;
        color: #fff !important;
    }
</style>

<div class="container mt-4">
    <h2 class="text-blue">Product List</h2>
    <table class="table table-striped table-bordered align-middle">
        <thead>
            <tr class="table-forst">
                @* <th scope="col">Product Image</th> *@
                <th scope="col">Product Name</th>
                <th scope="col">Product Price</th>
                <th scope="col">Product Quantity</th>
                <th scope="col">Remove Product</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.Products != null && Model.Products.Any())
            {
                var colorClasses = new[] { "row-forst", "row-lime", "row-blue" };
                var i = 0;
                foreach (var product in Model.Products)
                {
                    <tr class="@colorClasses[i % colorClasses.Length]">
                        @* <td>
                            <img src="@product.ImageUrl" alt="@product.Name" style="max-width: 80px; max-height: 80px;" class="img-thumbnail" />
                        </td> *@
                        <td>@product.name</td>
                        <td>@product.price.ToString("C", System.Globalization.CultureInfo.GetCultureInfo("en-US"))</td>
                        <td>@product.quantity</td>
                        <td>
                            <form method="post" asp-page-handler="Delete" asp-route-id="@product.id" style="display:inline;">
                                <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to remove this product?');">Remove</button>
                            </form>
                        </td>
                    </tr>
                    i++;
                }
            }
            else
            {
                <tr>
                    <td colspan="5" class="text-center">No products available.</td>
                </tr>
            }
        </tbody>
    </table>

    <button class="btn btn-success mt-3" id="addProductBtn" type="button" onclick="showAddProductForm()">Add Product</button>
    
    <div id="addProductForm" class="mt-4" style="display:none;">
        <div class="card">
            <div class="card-header table-forst">
                Add Product
            </div>
            <div class="card-body">
                @if (!string.IsNullOrEmpty(addProductError))
                {
                    <div class="alert alert-danger">@addProductError</div>
                }
                <form method="post">
                    <div class="mb-3">
                        <label for="Name" class="form-label">Name</label>
                        <input type="text" class="form-control" id="Name" name="Name" required />
                    </div>
                    <div class="mb-3">
                        <label for="Price" class="form-label">Price</label>
                        <input type="number" class="form-control" id="Price" name="Price" step="0.01" min="0" required />
                    </div>
                    <div class="mb-3">
                        <label for="Quantity" class="form-label">Quantity</label>
                        <input type="number" class="form-control" id="Quantity" name="Quantity" min="0" required />
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                    <button type="button" class="btn btn-secondary ms-2" onclick="hideAddProductForm()">Cancel</button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function showAddProductForm() {
            document.getElementById('addProductForm').style.display = 'block';
            document.getElementById('addProductBtn').style.display = 'none';
        }
        function hideAddProductForm() {
            document.getElementById('addProductForm').style.display = 'none';
            document.getElementById('addProductBtn').style.display = 'inline-block';
        }
        // Show form if server-side validation failed
        @if (showAddForm)
        {
            <text>
            document.getElementById('addProductForm').style.display = 'block';
            document.getElementById('addProductBtn').style.display = 'none';
            </text>
        }
    </script>
}
